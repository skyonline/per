/*b0e0d07d13a042e54cbfa73827f898e09cbe56a4*/Ext.define("Videoportal.view.controls.Header",{id:"Header",extend:"Ext.Container",xtype:"header",config:{docked:"top",layout:"hbox",items:[{xtype:"button",cls:"no_bg",flex:2,html:"<span>&nbsp</span>",id:"backBtnH"},{html:"<span>&nbsp</span>",flex:5,id:"logo1"},{xtype:"button",html:"<span>&nbsp</span>",flex:2,id:"homeBtnH"}]}});Ext.define("Videoportal.view.controls.Footer",{id:"Footer",extend:"Ext.Container",xtype:"footer",config:{docked:"bottom",layout:"hbox",items:[{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"filmsBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"seriasBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"showBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"childrenBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"tvBtnF"}]}});Ext.define("Videoportal.view.MainPage",{extend:"Ext.Container",id:"MainPage",xtype:"mainpage",requires:["Ext.data.Store","Ext.Carousel"],initialize:function(){var a=Videoportal.app.getController("MainPageController");a.loadMainData()},config:{layout:"card",items:[{xtype:"container",layout:"vbox",scrollable:{direction:"vertical",directionLock:true},items:[{xtype:"carousel",id:"filmpreview",indicator:false,height:"11em"},{xtype:"list",padding:"0.2em",itemTpl:'<div class="video-list-item"><tpl if="img"><img src="{img}" onload="this.style.opacity=1;"/></tpl><div class="itemTextWrapper"><h4>{title}</h4><small>{tags}</small></div><div class="addInfo"><span class="rank">{rank}</span><small class="countryTime">{country}&nbsp;{year}&nbsp;<tpl if="time">{time}&nbsp;мин.</tpl></small></div></div>',scrollable:false,id:"filmlist",listeners:{itemtap:function(d,b,e,a,c){Videoportal.app.getController("ListBaseController").onItemTap(d,b,e,a,c)}}}]}],listeners:{}}});Ext.define("Videoportal.view.ListPage",{extend:"Ext.dataview.List",id:"ListPage",xtype:"listpage",config:{padding:"0.2em",scrollable:{direction:"vertical",directionLock:true},itemTpl:'<div class="video-list-item"><tpl if="img"><img src="{img}" onload="this.style.opacity=1;"/></tpl><div class="itemTextWrapper"><h4>{title}</h4><small>{tags}</small></div><div class="addInfo"><span class="rank">{rank}</span><small class="countryTime">{country}&nbsp;{year}&nbsp;<tpl if="time">{time}&nbsp;мин.</tpl></small></div></div>',listeners:{itemtap:function(d,b,e,a,c){Videoportal.app.getController("ListBaseController").onItemTap(d,b,e,a,c)}}}});Ext.define("Videoportal.view.DetailsPage",{extend:"Ext.Container",id:"DetailsPage",xtype:"detailspage",config:{scrollable:{direction:"vertical",directionLock:true},items:[{xtype:"container",id:"detailsTop"}]}});Ext.define("Videoportal.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"Videoportal.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://persik.sib.by/export.html",reader:{type:"json"}}}});Ext.define("Videoportal.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content","leaf","list","thumb","tags","year","country","time","rank"],belongsTo:"Videoportal.model.ListModel",hasMany:{model:"Videoportal.model.ListItemModel",name:"list"}}});Ext.define("Videoportal.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://persik.sib.by/export.html",reader:{type:"json"}}}});Ext.define("Videoportal.view.Main",{extend:"Ext.Container",fullscreen:true,requires:["Videoportal.view.controls.Header","Videoportal.view.controls.Footer","Videoportal.view.MainPage","Videoportal.view.ListPage","Videoportal.view.DetailsPage"],id:"MainView",config:{layout:"fit",items:[{xtype:"header"},{id:"MainContainer",layout:"card",items:[{xtype:"mainpage"},{xtype:"listpage"},{xtype:"detailspage"}]},{xtype:"footer"}]}});Ext.define("Videoportal.controller.MainContainerController",{extend:Ext.app.Controller,requires:["Videoportal.model.ListModel","Videoportal.model.ListItemModel"],config:{refs:{mainContainer:"#MainContainer",listPage:"#ListPage",btnFilmsF:"#filmsBtnF",btnSeriasF:"#seriasBtnF",btnShowF:"#showBtnF",btnChildrenF:"#childrenBtnF",btnTvF:"#tvBtnF",btnHomeH:"#homeBtnH",btnBackH:"#backBtnH"},control:{btnFilmsF:{tap:"onFilmsF"},btnSeriasF:{tap:"onSeriasF"},btnShowF:{tap:"onShowF"},btnChildrenF:{tap:"onChildrenF"},btnTvF:{tap:"onTvF"},btnHomeH:{tap:"onHomeH"},btnBackH:{tap:"onBackH"}}},removeActiveCls:function(){Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")},onHomeH:function(a){this.getMainContainer().setActiveItem(0);this.getBtnBackH().addCls("no_bg");this.removeActiveCls()},onBackH:function(){var b=this.getMainContainer().getActiveItem();var a=b.getId();if(Ext.get(this.getBtnBackH().getId()).hasCls("no_bg")==false){if(a=="DetailsPage"){this.getBtnBackH().addCls("no_bg");if(b.prev=="ListPage"){this.getMainContainer().setActiveItem(1)}else{this.getMainContainer().setActiveItem(0)}}if(a=="ListPage"){var e=this.getListPage();var c=this.getListController();var d=c.stores.pop();e.setStore(d);if(c.stores.length==0){this.getBtnBackH().addCls("no_bg")}return}}},getListController:function(){return Videoportal.app.getController("ListBaseController")},onFilmsF:function(a){this.getListController().loadData(443,true);this.goToListPage();this.getBtnFilmsF().addCls("active")},onSeriasF:function(a){this.getListController().loadData(446,true);this.goToListPage();this.getBtnSeriasF().addCls("active")},onShowF:function(a){this.getListController().loadData(445,true);this.goToListPage();this.getBtnShowF().addCls("active")},onChildrenF:function(a){this.getListController().loadData(447,true);this.goToListPage();this.getBtnChildrenF().addCls("active")},onTvF:function(a){this.getListController().loadData(444,true);this.goToListPage();this.getBtnTvF().addCls("active")},goToListPage:function(){this.getBtnBackH().addCls("no_bg");this.removeActiveCls();var a=this.getListPage().getStore();if(a){a.removeAll()}this.getMainContainer().setActiveItem(1)}});Ext.define("Videoportal.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["Videoportal.model.EntryModel","Videoportal.model.ListModel","Videoportal.model.ListItemModel"],config:{refs:{listView:"#ListPage",detailsTop:"#detailsTop",detailsVideo:"#detailsVideo",detailsPage:"#DetailsPage",backBtn:"#backBtnH",mainContainer:"#MainContainer"}},getDetailsCardContent:function(a){return a.data.content},buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"Videoportal.model.ListItemModel",data:a}))},postListBuild:function(a){},loadData:function(e,a){if(!e){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}if(a){for(var b in this.stores){delete b}this.stores=[]}var d=this.getListView();var c=this;this.on({postBuild:this.postListBuild});this.loadModel("Videoportal.model.ListModel",e,function(f){c.processProperties(f.data.data);c.buildStore(d,f.data.data);c.fireEvent("postBuild",f.data.data)})},processProperties:function(b){var a=this;Ext.each(b,function(e,d,f){if(f[d].id){if(f[d].title==""){f[d].title=f[d].pagetitle}f[d].leaf=(f[d].leaf=="1");var c=f[d].list;if(c){a.processProperties(c)}}else{Ext.Array.remove(f,e)}})},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},detailsTopTpl:new Ext.XTemplate('<div class="video-details-item"><tpl if="img"><img class="poster" onload="this.style.opacity=1;" src="{img}"/><img class="play" src="resources/images/play.png"></img></tpl><div class="itemTextWrapper"><h4>{title}</h4><small>{tags}</small></div><div class="additionalInfo"><span class="rank">{rank}</span><small class="countryTime">{country}&nbsp;{year}&nbsp;<tpl if="time">{time}&nbsp;мин.</tpl></small></div></div><div class="content">{content}</div>'),onItemTap:function(f,c,g,b,e){this.getBackBtn().removeCls("no_bg");if(b.leaf==true||b.get("leaf")==true){var d=Ext.get("detailsTop");this.getMainContainer().setActiveItem(2);this.detailsTopTpl.overwrite(d,b.data||b);d.on({tap:function(i){var h=Ext.select("div.video-details-item img");h.setStyle("opacity","0.5");setTimeout(function(){window.open("rtsp://v5.cache1.c.youtube.com/CjYLENy73wIaLQkYIsC4v26zNBMYDSANFEIJbXYtZ29vZ2xlSARSBWluZGV4YP_oxaCTl4qhUAw=/0/0/0/video.3gp")},1000);h.setStyle("opacity","1")},element:"element",delegate:"div.video-details-item img"});if(f){this.getDetailsPage().prev=f.id}else{this.getDetailsPage().prev=null}}else{var a=this.getListView();this.stores.push(a.getStore());this.loadData(b.get("id"))}},stores:[]});Ext.define("Videoportal.controller.MainPageController",{extend:"Videoportal.controller.ListBaseController",requires:["Videoportal.model.EntryModel","Videoportal.model.ListModel","Videoportal.model.ListItemModel"],config:{refs:{listView:"#filmlist",listContainer:"#MainPage",carousel:"#filmpreview"}},postListBuild:function(b){var a=this;var c=this.getCarousel();c.on({tap:function(d){a.onItemTap(null,c.getActiveIndex(),null,b[c.getActiveIndex()])},element:"element",delegate:"div.carouselPoster"});c.removeAll();Ext.each(b,function(e,d){var f=new Ext.Template('<div class="carouselFilm"><div class="carouselPoster" style="background: url({img}) center no-repeat;background-size:contain; background-color: rgba(100, 100, 100, 0.5);" ><div class="film-title">{title}</div></div></div>');c.add({html:f.apply(e)});return true})},loadMainData:function(){var a=this;var b=this.loadData(450,true);this.getBackBtn().addCls("no_bg");Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")}});Ext.Loader.setPath({Ext:"sdk/src"});Ext.application({name:"Videoportal",isIconPrecomposed:true,views:["Main"],controllers:["MainContainerController","ListBaseController","MainPageController"],phoneStartupScreen:"resources/loading/Homescreen.jpg",tabletStartupScreen:"resources/loading/Homescreen~ipad.jpg",launch:function(){Ext.MessageBox.YESNO[0].text=GlobalMessages.No;Ext.MessageBox.YESNO[1].text=GlobalMessages.Yes;Ext.fly("appLoadingIndicator").destroy();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert(GlobalMessages.ErrorTitle,GlobalMessages.NoInetOfflineMode)}else{var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(){a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("Videoportal.view.Main"))},onUpdated:function(){window.location.reload()}});var userId=0;